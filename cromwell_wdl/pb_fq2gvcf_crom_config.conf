include required(classpath("application"))
backend {
  default = "LSF"
  providers {
    LSF {
      actor-factory = "cromwell.backend.impl.sfs.config.ConfigBackendLifecycleActorFactory"
      config {
        runtime-attributes = """
        Int cpus
        String requested_memory
        String? docker
        Int gpus
	String SCRATCH1="/scratch1/fs1/jin810"
        String BGA="/storage1/fs1/bga/Active"
        String STORAGE1="/storage1/fs1/jin810/Active"
        """
        submit = """
        bsub \
        -J ${job_name} \
        -cwd ${cwd} \
        -o /dev/null \
        -e /storage1/fs1/jin810/Active/pb_runs/NA12878/pb_fq2bam/crom_run/logs/cromwell-%J.err \
        -n ${cpus} \
	-G compute-jin810 \
        -M ${requested_memory} \
        -R "select[mem>${requested_memory}] rusage[mem=${requested_memory}] span[hosts=1]" \
        /bin/sh ${script}
        """
        submit-docker = """ 
        LSF_DOCKER_VOLUMES="/scratch1/fs1/ris/application/parabricks:/INSTALL ${cwd}:${docker_cwd} /scratch1/fs1/jin810:/scratch1/fs1/jin810 /storage1/fs1/bga/Active:/storage1/fs1/bga/Active /storage1/fs1/jin810/Active:/storage1/fs1/jin810/Active" \
        LSF_DOCKER_NETWORK=host \
        LSF_DOCKER_ENTRYPOINT=/bin/sh \
        bsub \
        -J ${job_name} \
        -cwd ${cwd} \
        -o /dev/null \
        -e /storage1/fs1/jin810/Active/pb_runs/NA12878/pb_fq2bam/crom_run/logs/cromwell-%J.err \
        -a "docker(${docker})" \
        -q general \
        -n ${cpus} \
        -M ${requested_memory} \
        -gpu "num=${gpus}:gmodel=TeslaV100_SXM2_32GB:j_exclusive=yes" \
        -G compute-jin810 \
        -R "select[mem>${requested_memory}] rusage[mem=${requested_memory}] span[hosts=1]" \
        /bin/sh ${script}
        """
        kill = "bkill ${job_id}"
        docker-kill = "bkill ${job_id}"
        check-alive = "bjobs -noheader -o stat ${job_id} | /bin/grep 'PEND\\|RUN'"
        job-id-regex = "Job <(\\d+)>.*"
        root = "/storage1/fs1/jin810/Active/pb_runs/NA12878/pb_fq2bam/crom_run"

        filesystems{
          local {
            localization: [
              "soft-link", "hard-link", "copy"
            ]
            caching {
              duplication-strategy: [
                "soft-link", "hard-link", "copy"
              ]
              hashing-strategy: "md5"
              fingerprint-size: 10485760
              check-sibling-md5: false
            }
          }
        }
      }  
    }  
  }
}
call-caching {
  enabled = true
  invalidate-bad-cache-results = true
  system.file-hash-cache = true
  docker.hash-lookup.method = "local"
}
workflow-options {
  workflow-log-dir = "/storage1/fs1/jin810/Active/pb_runs/NA12878/pb_fq2bam/crom_run/logs"
}
